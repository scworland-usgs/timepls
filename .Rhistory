?geom_point
??geom_point
library(timepls)
?combine_sites
install.packages("assertive")
library(assertive)
daily_pls <- function(data,lag=365,ncomps=3) {
assert_is_numeric(lag)
assert_is_numeric(ncomps)
# prepare data
lag <- lag
X <- cbind(embed(data$p,lag+1),embed(data$tmax,lag+1),embed(data$tmin,lag+1))
y <- data$cfs[(lag+1):nrow(data)]
date <- data$date[(lag+1):nrow(data)]
month <- data$month[(lag+1):nrow(data)]
day <- data$day[(lag+1):nrow(data)]
pls <- plsreg1(X, y, comps = ncomps)
# plot daily residuals
daily <- data.frame(date=date,
month=month,
day=day,
Q=y,
residuals=pls$resid)
p1 <- ggplot(daily) +
geom_line(aes(date,residuals)) +
geom_hline(yintercept=0,linetype="dashed",color="red") +
theme_bw()
# plot median monthly residuals
monthly <- daily %>%
group_by(day,month) %>%
summarize(residuals=median(residuals)) %>%
ungroup() %>%
arrange(month,day) %>%
mutate(day=1:(lag+1),
month=ordered(month.abb[month], month.abb))
season.color = colorRampPalette(c("blue","green","red","orange","blue"))(12)
p2 <- ggplot(monthly) + geom_line(aes(day,residuals),size=0.3) +
geom_line(aes(day,residuals,color=month)) + theme_bw() +
scale_color_manual(values=season.color) +
guides(col = guide_legend(ncol = 12)) +
geom_hline(yintercept=0, linetype="dashed") +
labs(x="Julian day",y="median residuals") +
theme(legend.position="bottom")
grid.arrange(p1,p2,ncol=1,top="Residuals from PLS model")
}
daily_pls(data,3,a)
daily_pls(data,3,"a")
?is.data.frame
?is_data.frame
library(pacman)
p_load(dplyr,ggplot2,dataRetrieval,stringr,lubridate,reshape2,WaveletComp)
# set working directory
setwd("~/Documents/climate_signals")
# source custom functions
functions <- list.files("scripts/functions",full.names=TRUE)
invisible(sapply(functions,source))
# find file names
file.names <- list.files("data/site_data")
# read in site coords
site.coords <- read.csv("data/site_coords.csv", colClasses = c("character", rep("numeric",2)))
# run combine and map functions
set.seed(876)
data <- combine_sites(N=1,file.names,folder='data/site_data',site.coords,random=T)
setwd("~/Documents/climate_signals/time_pls_package/timepls")
